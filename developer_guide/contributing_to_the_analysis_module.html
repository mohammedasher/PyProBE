
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contributing to the Analysis Module &#8212; PyProBE  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'developer_guide/contributing_to_the_analysis_module';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding a Cycler" href="adding_a_cycler.html" />
    <link rel="prev" title="Dependency Guide" href="dependency_guide.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">PyProBE  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/examples.html">
    Examples
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="developer_guide.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/modules.html">
    pyprobe
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/examples.html">
    Examples
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="developer_guide.html">
    Developer Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/modules.html">
    pyprobe
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="developer_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependency_guide.html">Dependency Guide</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Contributing to the Analysis Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding_a_cycler.html">Adding a Cycler</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="developer_guide.html" class="nav-link">Developer Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Contributing...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="contributing-to-the-analysis-module">
<span id="id1"></span><h1>Contributing to the Analysis Module<a class="headerlink" href="#contributing-to-the-analysis-module" title="Link to this heading">#</a></h1>
<p><a class="reference internal" href="../api/pyprobe.analysis.html#module-pyprobe.analysis" title="pyprobe.analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyprobe.analysis</span></code></a> classes are classes that perform further analysis of the data.</p>
<p>This document describes the standard format to be used for all PyProBE analysis classes.
Constructing your method in this way ensures compatibility with the rest of the
PyProBE package, while keeping your code clean and easy to read.</p>
<p>Analysis classes are based on <a class="reference external" href="https://docs.pydantic.dev/latest/api/base_model/">Pydantic BaseModel</a>
to provide input validation. However, following the steps below should allow
you to write your own analysis class without any direct interaction with pydantic
itself.</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Start by creating your class, which must inherit from
pydantic <code class="code docutils literal notranslate"><span class="pre">BaseModel</span></code>.</p></li>
<li><p>Declare <code class="code docutils literal notranslate"><span class="pre">input_data</span></code> as a variable and specify its type. The <a class="reference internal" href="../api/pyprobe.typing.html#module-pyprobe.typing" title="pyprobe.typing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyprobe.typing</span></code></a>
module has type aliases that may be helpful here. This type should be the most
lenient type that the methods of your analysis class require.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># 1. Define the class as a Pydantic BaseModel.</span>
<span class="linenos">2</span><span class="k">class</span> <span class="nc">Differentiation</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="linenos">3</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for differentiating experimental data.&quot;&quot;&quot;</span>
<span class="linenos">4</span>
<span class="linenos">5</span>    <span class="c1"># 2. Define the input_data attribute, giving it a type</span>
<span class="linenos">6</span>    <span class="n">input_data</span><span class="p">:</span> <span class="n">PyProBEDataType</span>
<span class="linenos">7</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;The input data for the differentiation.&quot;&quot;&quot;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Some analysis classes have multiple methods that need to pass information to each
other. For instance the <a class="reference internal" href="../api/pyprobe.analysis.degradation_mode_analysis.html#pyprobe.analysis.degradation_mode_analysis.DMA" title="pyprobe.analysis.degradation_mode_analysis.DMA"><code class="xref py py-class docutils literal notranslate"><span class="pre">DMA</span></code></a>
analysis class first calculates stoichiometry limits with the
<a class="reference internal" href="../api/pyprobe.analysis.degradation_mode_analysis.html#pyprobe.analysis.degradation_mode_analysis.DMA.fit_ocv" title="pyprobe.analysis.degradation_mode_analysis.DMA.fit_ocv"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit_ocv()</span></code></a> method, that are then
used in the <a class="reference internal" href="../api/pyprobe.analysis.degradation_mode_analysis.html#pyprobe.analysis.degradation_mode_analysis.DMA.quantify_degradation_modes" title="pyprobe.analysis.degradation_mode_analysis.DMA.quantify_degradation_modes"><code class="xref py py-func docutils literal notranslate"><span class="pre">quantify_degradation_modes()</span></code></a>
method. So, when <a class="reference internal" href="../api/pyprobe.analysis.degradation_mode_analysis.html#pyprobe.analysis.degradation_mode_analysis.DMA.fit_ocv" title="pyprobe.analysis.degradation_mode_analysis.DMA.fit_ocv"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit_ocv()</span></code></a> is called,
it saves this result in <cite>stoichiometry_limits</cite> for use later. If they are required,
these attributes must also be defined at the top of the class.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># 1. Define the class as a Pydantic BaseModel.</span>
<span class="linenos"> 2</span><span class="k">class</span> <span class="nc">DMA</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for degradation mode analysis methods.&quot;&quot;&quot;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>    <span class="c1"># 2. Define the input_data attribute, giving it a type</span>
<span class="linenos"> 6</span>    <span class="n">input_data</span><span class="p">:</span> <span class="n">PyProBEDataType</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;The input data for the degradation mode analysis.&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>    <span class="c1"># 3. Define the attributes that will be populated by the methods.</span>
<span class="linenos">10</span>    <span class="n">stoichiometry_limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Result</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">11</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;The stoichiometry limits and electrode capacities.&quot;&quot;&quot;</span>
<span class="linenos">12</span>    <span class="n">fitted_OCV</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Result</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">13</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;The fitted OCV data.&quot;&quot;&quot;</span>
<span class="linenos">14</span>    <span class="n">dma_result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Result</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">15</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;The degradation mode analysis results.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Then you can add any additional methods to perform your calculations.</p>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Link to this heading">#</a></h2>
<p>All calculations should be conducted inside methods. These are called by the user with
any additional information required to perform the analysis, and always return
<a class="reference internal" href="../api/pyprobe.result.html#pyprobe.result.Result" title="pyprobe.result.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> objects. We will use the
<a class="reference internal" href="../api/pyprobe.analysis.differentiation.html#pyprobe.analysis.differentiation.Differentiation.differentiate_FD" title="pyprobe.analysis.differentiation.Differentiation.differentiate_FD"><code class="xref py py-func docutils literal notranslate"><span class="pre">differentiate_FD()</span></code></a> method as an example.
The steps to write a method are as follows:</p>
<ol class="arabic simple">
<li><p>Define the method and its input parameters.</p></li>
<li><p>Check that inputs to the method are valid with the
<a class="reference internal" href="../api/pyprobe.analysis.utils.html#pyprobe.analysis.utils.AnalysisValidator" title="pyprobe.analysis.utils.AnalysisValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnalysisValidator</span></code></a> class. Provide the class the
input data to the method, the columns that are required for the computation to
be performed and the required data type for <cite>input_data`</cite> (only if it is a stricter
requirement than the type assigned to <cite>input_data</cite> above).</p></li>
<li><p>If needed, you can retrieve the columns specified in the <cite>required_columns</cite> field
as numpy arrays by accessing the <a class="reference internal" href="../api/pyprobe.analysis.utils.html#pyprobe.analysis.utils.AnalysisValidator.variables" title="pyprobe.analysis.utils.AnalysisValidator.variables"><code class="xref py py-attr docutils literal notranslate"><span class="pre">variables</span></code></a>
attribute of the instance of <a class="reference internal" href="../api/pyprobe.analysis.utils.html#pyprobe.analysis.utils.AnalysisValidator" title="pyprobe.analysis.utils.AnalysisValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnalysisValidator</span></code></a>.</p></li>
<li><p>Perform the required computation. In this example, this is done with <code class="xref py py-func docutils literal notranslate"><span class="pre">np.gradient()</span></code>,
a numpy built-in method. It is encouraged to perform as little of the underlying
computation as possible in the analysis class method. Instead, write simple functions
in the <a class="reference internal" href="../api/pyprobe.analysis.base.html#module-pyprobe.analysis.base" title="pyprobe.analysis.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyprobe.analysis.base</span></code></a> module that process only numpy arrays. This
keeps the mathematical underpinnings of PyProBE analysis methods readable, portable and
testable.</p></li>
<li><p>Create a result object to return. This is easily done with the <a class="reference internal" href="../api/pyprobe.result.html#pyprobe.result.Result.clean_copy" title="pyprobe.result.Result.clean_copy"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean_copy()</span></code></a>
method, which provides a copy of the input data including the <cite>info</cite> attribute but
replacing the data stored with a dataframe created from the provided dictionary.</p></li>
<li><p>Add column definitions to the created result object.</p></li>
<li><p>Return the result object.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>    <span class="k">def</span> <span class="nf">differentiate_FD</span><span class="p">(</span>  <span class="c1"># 1. Define the method</span>
<span class="linenos"> 2</span>        <span class="bp">self</span><span class="p">,</span>
<span class="linenos"> 3</span>        <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="linenos"> 4</span>        <span class="n">y</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="linenos"> 5</span>        <span class="n">gradient</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dydx&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Differentiate smooth data with the finite difference method.</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="sd">        A light wrapper of the numpy.gradient function.</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="sd">        Args:</span>
<span class="linenos">12</span><span class="sd">            x (str): The name of the x variable.</span>
<span class="linenos">13</span><span class="sd">            y (str): The name of the y variable.</span>
<span class="linenos">14</span><span class="sd">            gradient (str, optional):</span>
<span class="linenos">15</span><span class="sd">                The gradient to calculate, either &#39;dydx&#39; or &#39;dxdy&#39;.</span>
<span class="linenos">16</span><span class="sd">                Defaults to &quot;dydx&quot;.</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="sd">        Returns:</span>
<span class="linenos">19</span><span class="sd">            Result:</span>
<span class="linenos">20</span><span class="sd">                A result object containing the columns, `x`, `y` and the</span>
<span class="linenos">21</span><span class="sd">                calculated gradient.</span>
<span class="linenos">22</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">23</span>        <span class="c1"># 2. Validate the inputs to the method</span>
<span class="linenos">24</span>        <span class="n">validator</span> <span class="o">=</span> <span class="n">AnalysisValidator</span><span class="p">(</span>
<span class="linenos">25</span>            <span class="n">input_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span>
<span class="linenos">26</span>            <span class="n">required_columns</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
<span class="linenos">27</span>            <span class="c1"># required_type not neccessary here as type specified when declaring</span>
<span class="linenos">28</span>            <span class="c1"># input_data attribute is strict enough</span>
<span class="linenos">29</span>        <span class="p">)</span>
<span class="linenos">30</span>        <span class="c1"># 3. Retrieve the validated columns as numpy arrays</span>
<span class="linenos">31</span>        <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">variables</span>
<span class="linenos">32</span>
<span class="linenos">33</span>        <span class="c1"># 4. Perform the computation</span>
<span class="linenos">34</span>        <span class="k">if</span> <span class="n">gradient</span> <span class="o">==</span> <span class="s2">&quot;dydx&quot;</span><span class="p">:</span>
<span class="linenos">35</span>            <span class="n">gradient_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;d(</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">)/d(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="linenos">36</span>            <span class="n">gradient_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">y_data</span><span class="p">,</span> <span class="n">x_data</span><span class="p">)</span>
<span class="linenos">37</span>        <span class="k">elif</span> <span class="n">gradient</span> <span class="o">==</span> <span class="s2">&quot;dxdy&quot;</span><span class="p">:</span>
<span class="linenos">38</span>            <span class="n">gradient_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;d(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)/d(</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="linenos">39</span>            <span class="n">gradient_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">)</span>
<span class="linenos">40</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">41</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gradient must be either &#39;dydx&#39; or &#39;dxdy&#39;.&quot;</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span>        <span class="c1"># 5. Create a Result object to store the results</span>
<span class="linenos">44</span>        <span class="n">gradient_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">clean_copy</span><span class="p">(</span>
<span class="linenos">45</span>            <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">x</span><span class="p">:</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">gradient_title</span><span class="p">:</span> <span class="n">gradient_data</span><span class="p">})</span>
<span class="linenos">46</span>        <span class="p">)</span>
<span class="linenos">47</span>        <span class="c1"># 6. Define the column definitions for the Result object</span>
<span class="linenos">48</span>        <span class="n">gradient_result</span><span class="o">.</span><span class="n">column_definitions</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">49</span>            <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">column_definitions</span><span class="p">[</span><span class="n">x</span><span class="p">],</span>
<span class="linenos">50</span>            <span class="n">y</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">column_definitions</span><span class="p">[</span><span class="n">y</span><span class="p">],</span>
<span class="linenos">51</span>            <span class="n">gradient_title</span><span class="p">:</span> <span class="s2">&quot;The calculated gradient.&quot;</span><span class="p">,</span>
<span class="linenos">52</span>        <span class="p">}</span>
<span class="linenos">53</span>        <span class="c1"># 7. Return the Result object</span>
<span class="linenos">54</span>        <span class="k">return</span> <span class="n">gradient_result</span>
</pre></div>
</div>
</section>
<section id="base">
<h2>Base<a class="headerlink" href="#base" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="../api/pyprobe.analysis.base.html#module-pyprobe.analysis.base" title="pyprobe.analysis.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyprobe.analysis.base</span></code></a> module exists as a repository for functions to work in
the rest of the analysis module. Often with data analysis code, it is tempting to include
data manipulation (forming arrays, dataframes etc. from your standard data format)
alongside calculations. By keeping the data manipulation inside the methods of classes
in the <a class="reference internal" href="../api/pyprobe.analysis.html#module-pyprobe.analysis" title="pyprobe.analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyprobe.analysis</span></code></a> and calculations in the <a class="reference internal" href="../api/pyprobe.analysis.base.html#module-pyprobe.analysis.base" title="pyprobe.analysis.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">base</span></code></a>
submodule, these functions remain more readable, testable and portable.</p>
<p><a class="reference internal" href="../api/pyprobe.analysis.base.html#module-pyprobe.analysis.base" title="pyprobe.analysis.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">base</span></code></a> module functions should be defined as simply as possible,
accepting and returning only arrays and floating-point numbers, with clearly defined
variables. A good example is the
<a class="reference internal" href="../api/pyprobe.analysis.base.degradation_mode_analysis_functions.html#pyprobe.analysis.base.degradation_mode_analysis_functions.calc_electrode_capacities" title="pyprobe.analysis.base.degradation_mode_analysis_functions.calc_electrode_capacities"><code class="xref py py-func docutils literal notranslate"><span class="pre">calc_electrode_capacities()</span></code></a> function
in the <a class="reference internal" href="../api/pyprobe.analysis.base.degradation_mode_analysis_functions.html#module-pyprobe.analysis.base.degradation_mode_analysis_functions" title="pyprobe.analysis.base.degradation_mode_analysis_functions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">degradation_mode_analysis_functions</span></code></a> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">calc_electrode_capacities</span><span class="p">(</span>
<span class="linenos"> 2</span>    <span class="n">x_pe_lo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="linenos"> 3</span>    <span class="n">x_pe_hi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="linenos"> 4</span>    <span class="n">x_ne_lo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="n">x_ne_hi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="linenos"> 6</span>    <span class="n">cell_capacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the electrode capacities.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="sd">    Args:</span>
<span class="linenos">11</span><span class="sd">        x_pe_lo (float): The cathode stoichiometry at lowest cell SOC.</span>
<span class="linenos">12</span><span class="sd">        x_pe_hi (float): The cathode stoichiometry at highest cell SOC.</span>
<span class="linenos">13</span><span class="sd">        x_ne_lo (float): The anode stoichiometry at lowest cell SOC.</span>
<span class="linenos">14</span><span class="sd">        x_ne_hi (float): The anode stoichiometry at highest cell SOC.</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="sd">    Returns:</span>
<span class="linenos">17</span><span class="sd">        Tuple[float, float, float]:</span>
<span class="linenos">18</span><span class="sd">            - NDArray: The cathode capacity.</span>
<span class="linenos">19</span><span class="sd">            - NDArray: The anode capacity.</span>
<span class="linenos">20</span><span class="sd">            - NDArray: The lithium inventory.</span>
<span class="linenos">21</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">22</span>    <span class="n">pe_capacity</span> <span class="o">=</span> <span class="n">cell_capacity</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_pe_lo</span> <span class="o">-</span> <span class="n">x_pe_hi</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">ne_capacity</span> <span class="o">=</span> <span class="n">cell_capacity</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_ne_hi</span> <span class="o">-</span> <span class="n">x_ne_lo</span><span class="p">)</span>
<span class="linenos">24</span>    <span class="n">li_inventory</span> <span class="o">=</span> <span class="p">(</span><span class="n">pe_capacity</span> <span class="o">*</span> <span class="n">x_pe_lo</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ne_capacity</span> <span class="o">*</span> <span class="n">x_ne_lo</span><span class="p">)</span>
<span class="linenos">25</span>    <span class="k">return</span> <span class="n">pe_capacity</span><span class="p">,</span> <span class="n">ne_capacity</span><span class="p">,</span> <span class="n">li_inventory</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="dependency_guide.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Dependency Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="adding_a_cycler.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Adding a Cycler</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">Methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#base">Base</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/developer_guide/contributing_to_the_analysis_module.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Thomas Holland, Electrochemical Science and Engineering Group, Imperial College London.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>